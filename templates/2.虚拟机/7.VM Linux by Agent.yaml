zabbix_export:
  version: '6.4'
  template_groups:
    - uuid: 1ca493b5f54049d984ee8f382812c995
      name: 'Templates/Common'
  templates:
    - uuid: d2ef8723535c44a1895ba022f0577498
      template: 'VM Linux by Agent'
      name: 'VM Linux by Agent'
      description: |
        Official Linux template. Requires agent of ZOps 7.0 or newer.
              
        You can discuss this template or leave feedback on our forum https://www.ZOps.com/forum/ZOps-suggestions-and-feedback/387225-discussion-thread-for-official-ZOps-template-for-linux
        
        Generated by official ZOps template tool "Templator" 2.0.0
      vendor:
        name: ZOps
        version: 6.4-0
      groups:
        - name: 'Templates/Common'
      items:
        - uuid: 7db2f257cf4c46b9af3ba5b2bf43480e
          name: 'Host name of ZOps agent running'
          key: agent.hostname
          delay: 1h
          history: 7d
          trends: '0'
          value_type: CHAR
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1d
          tags:
            - tag: component
              value: system
        - uuid: 3a0de71109184ad18726af9c5b78be75
          name: 'Online Status'
          key: agent.ping
          history: 7d
          description: 'The agent always returns 1 for this item. It could be used in combination with nodata() for availability check.'
          valuemap:
            name: 'ZOps agent ping status'
          tags:
            - tag: component
              value: system
        - uuid: 044713c2f605439c88dfb1289045203d
          name: 'Version of ZOps agent running'
          key: agent.version
          delay: 1h
          history: 7d
          trends: '0'
          value_type: CHAR
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1d
          tags:
            - tag: component
              value: application
        - uuid: ace1278b871240028e6336e076321811
          name: 'Maximum number of open file descriptors'
          key: kernel.maxfiles
          delay: 1h
          history: 7d
          description: 'It could be increased by using `sysctl` utility or modifying the file `/etc/sysctl.conf`.'
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1d
          tags:
            - tag: component
              value: system
          triggers:
            - uuid: 759f387626d947b39bc0f42254abc5df
              expression: 'last(/VM Linux by Agent/kernel.maxfiles)<{$KERNEL.MAXFILES.MIN}'
              name: 'Configured max number of open filedescriptors is too low'
              event_name: 'Configured max number of open filedescriptors is too low (< {$KERNEL.MAXFILES.MIN})'
              priority: INFO
              tags:
                - tag: scope
                  value: performance
        - uuid: 9af77bc72f7b45b8b2197d8c6ffe011b
          name: 'Maximum number of processes'
          key: kernel.maxproc
          delay: 1h
          history: 7d
          description: 'It could be increased by using `sysctl` utility or modifying the file `/etc/sysctl.conf`.'
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1d
          tags:
            - tag: component
              value: system
          triggers:
            - uuid: 88683a1762d7430da6866ab63fa56df6
              expression: 'last(/VM Linux by Agent/kernel.maxproc)<{$KERNEL.MAXPROC.MIN}'
              name: 'Configured max number of processes is too low'
              event_name: 'Configured max number of processes is too low (< {$KERNEL.MAXPROC.MIN})'
              priority: INFO
              dependencies:
                - name: 'Getting closer to process limit'
                  expression: 'last(/VM Linux by Agent/proc.num)/last(/VM Linux by Agent/kernel.maxproc)*100>80'
              tags:
                - tag: scope
                  value: performance
        - uuid: 9ddf154b1bfd4ce797bd87410a2755e9
          name: 'Number of processes'
          key: proc.num
          history: 7d
          tags:
            - tag: component
              value: system
        - uuid: 825a086e099c483e973624d1c14a3987
          name: 'Number of running processes'
          key: 'proc.num[,,run]'
          history: 7d
          tags:
            - tag: component
              value: system
        - uuid: fcd337e2cac042d68a94bd5681b4a3c7
          name: 'System boot time'
          key: system.boottime
          delay: 15m
          history: 7d
          units: unixtime
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
          tags:
            - tag: component
              value: system
        - uuid: 93302469f04846889a23264e360f32dd
          name: 'Interrupts per second'
          key: system.cpu.intr
          history: 7d
          value_type: FLOAT
          preprocessing:
            - type: CHANGE_PER_SECOND
              parameters:
                - ''
          tags:
            - tag: component
              value: cpu
        - uuid: 9bd5a85c54fa4c7f89dec3a24911edea
          name: 'Load average (1m avg)'
          key: 'system.cpu.load[all,avg1]'
          history: 7d
          value_type: FLOAT
          tags:
            - tag: component
              value: cpu
        - uuid: cd3687a95c854a3f860d3bef0548aec1
          name: 'Load average (5m avg)'
          key: 'system.cpu.load[all,avg5]'
          history: 7d
          value_type: FLOAT
          tags:
            - tag: component
              value: cpu
        - uuid: 8fcdd884ff0d4dcfa3a0ea6139c12965
          name: 'Load average (15m avg)'
          key: 'system.cpu.load[all,avg15]'
          history: 7d
          value_type: FLOAT
          tags:
            - tag: component
              value: cpu
        - uuid: 82b4d8f2a28d4f4d920f31f50a4b7f30
          name: 'Number of CPUs'
          key: system.cpu.num
          history: 7d
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1d
          tags:
            - tag: component
              value: cpu
        - uuid: 6c8d0e656c634e2db58e67112bc591cb
          name: 'Context switches per second'
          key: system.cpu.switches
          history: 7d
          value_type: FLOAT
          preprocessing:
            - type: CHANGE_PER_SECOND
              parameters:
                - ''
          tags:
            - tag: component
              value: cpu
        - uuid: 7d97691b5c3e403a8259b245f822fb09
          name: 'CPU utilization'
          type: DEPENDENT
          key: system.cpu.util
          delay: '0'
          history: 7d
          value_type: FLOAT
          units: '%'
          description: 'The CPU utilization expressed in %.'
          preprocessing:
            - type: JAVASCRIPT
              parameters:
                - |
                  //Calculate utilization
                  return (100 - value)
          master_item:
            key: 'system.cpu.util[,idle]'
          tags:
            - tag: component
              value: cpu
          triggers:
            - uuid: 5f9c1f4f31e7472d92ee398d1cf366d4
              expression: 'min(/VM Linux by Agent/system.cpu.util,5m)>{$CPU.UTIL.CRIT}'
              name: 'High CPU utilization'
              event_name: 'High CPU utilization (over {$CPU.UTIL.CRIT}% for 5m)'
              opdata: 'Current utilization: {ITEM.LASTVALUE1}'
              priority: WARNING
              description: 'The CPU utilization is too high. The system might be slow to respond.'
              dependencies:
                - name: 'Load average is too high'
                  expression: |
                    min(/VM Linux by Agent/system.cpu.load[all,avg1],5m)/last(/VM Linux by Agent/system.cpu.num)>{$LOAD_AVG_PER_CPU.MAX.WARN}
                    and last(/VM Linux by Agent/system.cpu.load[all,avg5])>0
                    and last(/VM Linux by Agent/system.cpu.load[all,avg15])>0
              tags:
                - tag: scope
                  value: performance
        - uuid: 9bec8a3a747c49cc838f45110da9b3cc
          name: 'CPU guest time'
          key: 'system.cpu.util[,guest]'
          history: 7d
          value_type: FLOAT
          units: '%'
          description: 'Guest time - the time spent on running a virtual CPU for a guest operating system.'
          tags:
            - tag: component
              value: cpu
        - uuid: d4ba32be539049908297fd3cbe24a4dd
          name: 'CPU guest nice time'
          key: 'system.cpu.util[,guest_nice]'
          history: 7d
          value_type: FLOAT
          units: '%'
          description: 'The time spent on running a niced guest (a virtual CPU for guest operating systems under the control of the Linux kernel).'
          tags:
            - tag: component
              value: cpu
        - uuid: 0715d71d0a264890854026a2c9c6e9dc
          name: 'CPU idle time'
          key: 'system.cpu.util[,idle]'
          history: 7d
          value_type: FLOAT
          units: '%'
          description: 'The time the CPU has spent doing nothing.'
          tags:
            - tag: component
              value: cpu
        - uuid: 7c694a37af2c402482153cd6b18e6e05
          name: 'CPU interrupt time'
          key: 'system.cpu.util[,interrupt]'
          history: 7d
          value_type: FLOAT
          units: '%'
          description: 'The amount of time the CPU has been servicing hardware interrupts.'
          tags:
            - tag: component
              value: cpu
        - uuid: 39f234c022524a0dbf63201f294d41ea
          name: 'CPU iowait time'
          key: 'system.cpu.util[,iowait]'
          history: 7d
          value_type: FLOAT
          units: '%'
          description: 'The amount of time the CPU has been waiting for I/O to complete.'
          tags:
            - tag: component
              value: cpu
        - uuid: dfc0fd5115b54b1489c663e4aed3edfe
          name: 'CPU nice time'
          key: 'system.cpu.util[,nice]'
          history: 7d
          value_type: FLOAT
          units: '%'
          description: 'The time the CPU has spent running users'' processes that have been niced.'
          tags:
            - tag: component
              value: cpu
        - uuid: c7e75c3cd0684ff08adcac66cd3d0425
          name: 'CPU softirq time'
          key: 'system.cpu.util[,softirq]'
          history: 7d
          value_type: FLOAT
          units: '%'
          description: 'The amount of time the CPU has been servicing software interrupts.'
          tags:
            - tag: component
              value: cpu
        - uuid: 5c07c4bb401b44d1bb6eddc44354d00e
          name: 'CPU steal time'
          key: 'system.cpu.util[,steal]'
          history: 7d
          value_type: FLOAT
          units: '%'
          description: 'The amount of "stolen" CPU from this virtual machine by the hypervisor for other tasks, such as running another virtual machine.'
          tags:
            - tag: component
              value: cpu
        - uuid: 4f97c41f6736494589b5de7b200777ec
          name: 'CPU system time'
          key: 'system.cpu.util[,system]'
          history: 7d
          value_type: FLOAT
          units: '%'
          description: 'The time the CPU has spent running the kernel and its processes.'
          tags:
            - tag: component
              value: cpu
        - uuid: fac1f003f4d24ab896897dbc3d8a80f6
          name: 'CPU user time'
          key: 'system.cpu.util[,user]'
          history: 7d
          value_type: FLOAT
          units: '%'
          description: 'The time the CPU has spent running users'' processes that are not niced.'
          tags:
            - tag: component
              value: cpu
        - uuid: d7eebc9852484181b94bc4730b18b022
          name: 'System name'
          key: system.hostname
          delay: 1h
          history: 2w
          trends: '0'
          value_type: CHAR
          description: 'The host name of the system.'
          inventory_link: NAME
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 12h
          tags:
            - tag: component
              value: system
          triggers:
            - uuid: 17c8dbbf68044790ad7761c0b44f85f0
              expression: 'change(/VM Linux by Agent/system.hostname) and length(last(/VM Linux by Agent/system.hostname))>0'
              name: 'System name has changed'
              event_name: 'System name has changed (new name: {ITEM.VALUE})'
              priority: INFO
              description: 'The name of the system has changed. Acknowledge to close the problem manually.'
              manual_close: 'YES'
              tags:
                - tag: scope
                  value: notice
                - tag: scope
                  value: security
        - uuid: 220dfeffe4894566a50d90f8271239d8
          name: 'System local time'
          key: system.localtime
          history: 7d
          units: unixtime
          description: 'The local system time of the host.'
          tags:
            - tag: component
              value: system
          triggers:
            - uuid: 936bfb3cc2704a149c5dff5d7603ab4a
              expression: 'fuzzytime(/VM Linux by Agent/system.localtime,{$SYSTEM.FUZZYTIME.MAX})=0'
              name: 'System time is out of sync'
              event_name: 'System time is out of sync (diff with ZOps server > {$SYSTEM.FUZZYTIME.MAX}s)'
              priority: WARNING
              description: 'The host''s system time is different from ZOps server time.'
              manual_close: 'YES'
              tags:
                - tag: scope
                  value: availability
                - tag: scope
                  value: performance
        - uuid: 970d0e98063742068eaa9aa9fa1618d8
          name: 'Operating system architecture'
          key: system.sw.arch
          delay: 1h
          history: 2w
          trends: '0'
          value_type: CHAR
          description: 'The architecture of the operating system.'
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1d
          tags:
            - tag: component
              value: os
        - uuid: ce06e8e5db2343df9354c092475b34df
          name: 'Operating system'
          key: system.sw.os
          delay: 1h
          history: 2w
          trends: '0'
          value_type: CHAR
          inventory_link: OS
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1d
          tags:
            - tag: component
              value: os
          triggers:
            - uuid: c47ef3eac8ca4d28bfdacd2f6cd55ff9
              expression: 'change(/VM Linux by Agent/system.sw.os) and length(last(/VM Linux by Agent/system.sw.os))>0'
              name: 'Operating system description has changed'
              priority: INFO
              description: 'The description of the operating system has changed. Possible reasons are that the system has been updated or replaced. Acknowledge to close the problem manually.'
              manual_close: 'YES'
              dependencies:
                - name: 'System name has changed'
                  expression: 'change(/VM Linux by Agent/system.hostname) and length(last(/VM Linux by Agent/system.hostname))>0'
              tags:
                - tag: scope
                  value: notice
        - uuid: 40bdd9cf8dc04e28ad204c2fa84430a4
          name: 'Number of installed packages'
          key: system.sw.packages.get
          delay: 1h
          history: 7d
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.length()
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 12h
          tags:
            - tag: component
              value: os
          triggers:
            - uuid: 3893fd7f8a19401ea36fb648615b7f1a
              expression: 'change(/VM Linux by Agent/system.sw.packages.get)<>0'
              name: 'Number of installed packages has been changed'
              priority: WARNING
              manual_close: 'YES'
              tags:
                - tag: scope
                  value: notice
        - uuid: 187ffba06cab4a4d9b4956d567b2e15a
          name: 'Free swap space'
          key: 'system.swap.size[,free]'
          history: 7d
          units: B
          description: 'The free space of the swap volume/file expressed in bytes.'
          tags:
            - tag: component
              value: memory
            - tag: component
              value: storage
        - uuid: c885c240d60c45b08f78b9501f859114
          name: 'Free swap space in %'
          key: 'system.swap.size[,pfree]'
          history: 7d
          value_type: FLOAT
          units: '%'
          description: 'The free space of the swap volume/file expressed in %.'
          tags:
            - tag: component
              value: memory
            - tag: component
              value: storage
        - uuid: 7de8e3f697bc4b0298febc6d89df8d66
          name: 'Total swap space'
          key: 'system.swap.size[,total]'
          history: 7d
          units: B
          description: 'The total space of the swap volume/file expressed in bytes.'
          tags:
            - tag: component
              value: memory
            - tag: component
              value: storage
        - uuid: e9ab89f373ff4ec59a0b52e9997a2668
          name: 'System description'
          key: system.uname
          delay: 15m
          history: 2w
          trends: '0'
          value_type: CHAR
          description: 'The information as normally returned by `uname -a`.'
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 12h
          tags:
            - tag: component
              value: system
        - uuid: 89081e4e2eb84114a3898eb4f9b24832
          name: 'System uptime'
          key: system.uptime
          delay: 30s
          history: 2w
          trends: '0'
          units: uptime
          description: 'The system uptime expressed in the following format: "N days, hh:mm:ss".'
          tags:
            - tag: component
              value: system
          triggers:
            - uuid: 559d41298fb1410393cc9338abe08df8
              expression: 'last(/VM Linux by Agent/system.uptime)<10m'
              name: '{HOST.NAME} has been restarted'
              event_name: '{HOST.NAME} has been restarted (uptime < 10m)'
              priority: WARNING
              description: 'The host uptime is less than 10 minutes.'
              manual_close: 'YES'
              tags:
                - tag: scope
                  value: notice
        - uuid: 560acfd4300747349f4774a49b5601d3
          name: 'Number of logged in users'
          key: system.users.num
          history: 7d
          description: 'The number of users who are currently logged in.'
          tags:
            - tag: component
              value: environment
        - uuid: 9e2f9c0094b34b4d93245c8bd86b1033
          name: 'Checksum of /etc/passwd'
          key: 'vfs.file.cksum[/etc/passwd,sha256]'
          delay: 15m
          history: 7d
          trends: '0'
          value_type: CHAR
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
          tags:
            - tag: component
              value: security
          triggers:
            - uuid: a12ff31c53e948d0a93d2d943fdd613b
              expression: 'last(/VM Linux by Agent/vfs.file.cksum[/etc/passwd,sha256],#1)<>last(/VM Linux by Agent/vfs.file.cksum[/etc/passwd,sha256],#2)'
              name: '/etc/passwd has been changed'
              priority: INFO
              manual_close: 'YES'
              dependencies:
                - name: 'Operating system description has changed'
                  expression: 'change(/VM Linux by Agent/system.sw.os) and length(last(/VM Linux by Agent/system.sw.os))>0'
                - name: 'System name has changed'
                  expression: 'change(/VM Linux by Agent/system.hostname) and length(last(/VM Linux by Agent/system.hostname))>0'
              tags:
                - tag: scope
                  value: security
        - uuid: 02bfbd4d552b4818a022e66a49a35d87
          name: 'Get filesystems'
          key: vfs.fs.get
          history: '0'
          trends: '0'
          value_type: TEXT
          description: 'The `vfs.fs.get` key acquires raw information set about the file systems. Later to be extracted by preprocessing in dependent items.'
          tags:
            - tag: component
              value: raw
        - uuid: 56b1110ed02443fdb603bb757d8dbf6e
          name: 'Available memory'
          key: 'vm.memory.size[available]'
          history: 7d
          units: B
          description: |
            The available memory:
            - in Linux - available = free + buffers + cache;
            - on other platforms calculation may vary.
            
            See also Appendixes in ZOps Documentation about parameters of the `vm.memory.size` item.
          tags:
            - tag: component
              value: memory
        - uuid: c0d7633b2a3a4f1e8ded07c99dbecc4a
          name: 'Available memory in %'
          key: 'vm.memory.size[pavailable]'
          history: 7d
          value_type: FLOAT
          units: '%'
          description: 'The available memory as percentage of the total. See also Appendixes in ZOps Documentation about parameters of the `vm.memory.size` item.'
          tags:
            - tag: component
              value: memory
        - uuid: 03f80e018172498fa94491b6b48710e9
          name: 'Total memory'
          key: 'vm.memory.size[total]'
          history: 7d
          units: B
          description: 'The total memory expressed in bytes.'
          tags:
            - tag: component
              value: memory
        - uuid: 279233723b014eaba33bb2cf726ebf73
          name: 'Memory utilization'
          type: DEPENDENT
          key: vm.memory.utilization
          delay: '0'
          history: 7d
          value_type: FLOAT
          units: '%'
          description: 'The percentage of used memory is calculated as `100-pavailable`.'
          preprocessing:
            - type: JAVASCRIPT
              parameters:
                - 'return (100-value);'
          master_item:
            key: 'vm.memory.size[pavailable]'
          tags:
            - tag: component
              value: memory
          triggers:
            - uuid: c731e67cd4ea414eb0f5c6f29a6b0bba
              expression: 'min(/VM Linux by Agent/vm.memory.utilization,5m)>{$MEMORY.UTIL.MAX}'
              name: 'High memory utilization'
              event_name: 'High memory utilization (>{$MEMORY.UTIL.MAX}% for 5m)'
              priority: AVERAGE
              description: 'The system is running out of free memory.'
              dependencies:
                - name: 'Lack of available memory'
                  expression: 'max(/VM Linux by Agent/vm.memory.size[available],5m)<{$MEMORY.AVAILABLE.MIN} and last(/VM Linux by Agent/vm.memory.size[total])>0'
              tags:
                - tag: scope
                  value: capacity
                - tag: scope
                  value: performance
        - uuid: 7405ed51a72d44d7a0e1a82455cd085d
          name: 'ZOps agent availability'
          type: INTERNAL
          key: 'ZOps[host,agent,available]'
          history: 7d
          description: 'Monitoring the availability status of the agent.'
          valuemap:
            name: ZOps.host.available
          tags:
            - tag: component
              value: system
          triggers:
            - uuid: 96259140ea894bbdb357de951fa0611e
              expression: 'max(/VM Linux by Agent/ZOps[host,agent,available],{$AGENT.TIMEOUT})=0'
              name: 'ZOps agent is not available'
              event_name: 'ZOps agent is not available (for {$AGENT.TIMEOUT})'
              priority: AVERAGE
              description: 'For passive only agents, host availability is used with {$AGENT.TIMEOUT} as time threshold.'
              manual_close: 'YES'
              tags:
                - tag: scope
                  value: availability
      discovery_rules:
        - uuid: 8fcf7785604e49c59049f2d7e2eef343
          name: 'Network interface discovery'
          key: net.if.discovery
          delay: 1h
          filter:
            evaltype: AND
            conditions:
              - macro: '{#IFNAME}'
                value: '{$NET.IF.IFNAME.MATCHES}'
                formulaid: A
              - macro: '{#IFNAME}'
                value: '{$NET.IF.IFNAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: B
          description: 'The discovery of network interfaces.'
          item_prototypes:
            - uuid: c1b1128501014b1e834fe5c98d039bd9
              name: 'Interface {#IFNAME}: Inbound packets discarded'
              key: 'net.if.in["{#IFNAME}",dropped]'
              delay: 3m
              history: 7d
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
              tags:
                - tag: component
                  value: network
                - tag: interface
                  value: '{#IFNAME}'
            - uuid: 891b1775221742eeb3cf4057e5fadb90
              name: 'Interface {#IFNAME}: Inbound packets with errors'
              key: 'net.if.in["{#IFNAME}",errors]'
              delay: 3m
              history: 7d
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
              tags:
                - tag: component
                  value: network
                - tag: interface
                  value: '{#IFNAME}'
            - uuid: 4d9ef9c78af54752b5fb9b0059a65f66
              name: 'Interface {#IFNAME}: Bits received'
              key: 'net.if.in["{#IFNAME}"]'
              delay: 3m
              history: 7d
              units: bps
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                - type: MULTIPLIER
                  parameters:
                    - '8'
              tags:
                - tag: component
                  value: network
                - tag: interface
                  value: '{#IFNAME}'
            - uuid: 0812bcf6acc3427b9eac8102b39e8701
              name: 'Interface {#IFNAME}: Outbound packets discarded'
              key: 'net.if.out["{#IFNAME}",dropped]'
              delay: 3m
              history: 7d
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
              tags:
                - tag: component
                  value: network
                - tag: interface
                  value: '{#IFNAME}'
            - uuid: 3a305367c43e432b8299c0a1a3f25e1f
              name: 'Interface {#IFNAME}: Outbound packets with errors'
              key: 'net.if.out["{#IFNAME}",errors]'
              delay: 3m
              history: 7d
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
              tags:
                - tag: component
                  value: network
                - tag: interface
                  value: '{#IFNAME}'
            - uuid: 5d07784304314ac48a52d67ef265987b
              name: 'Interface {#IFNAME}: Bits sent'
              key: 'net.if.out["{#IFNAME}"]'
              delay: 3m
              history: 7d
              units: bps
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                - type: MULTIPLIER
                  parameters:
                    - '8'
              tags:
                - tag: component
                  value: network
                - tag: interface
                  value: '{#IFNAME}'
            - uuid: 7c933f1d2dc14aa98deb56cc5b1b8b0a
              name: 'Interface {#IFNAME}: Operational status'
              key: 'vfs.file.contents["/sys/class/net/{#IFNAME}/operstate"]'
              history: 7d
              trends: '0'
              description: 'Reference: https://www.kernel.org/doc/Documentation/networking/operstates.txt'
              valuemap:
                name: ifOperStatus
              preprocessing:
                - type: JAVASCRIPT
                  parameters:
                    - |
                      var newvalue;
                      switch(value) {
                        case "unknown":
                          newvalue = 0;
                          break;
                        case "notpresent":
                          newvalue = 1;
                          break;
                        case "down":
                          newvalue = 2;
                          break;
                        case "lowerlayerdown":
                          newvalue = 3;
                          break;
                        case "testing":
                          newvalue = 4;
                          break;
                        case "dormant":
                          newvalue = 5;
                          break;
                        case "up":
                          newvalue = 6;
                          break;  default:
                          newvalue = "Problem parsing interface operstate in JS";
                      }
                      return newvalue;
              tags:
                - tag: component
                  value: network
                - tag: interface
                  value: '{#IFNAME}'
              trigger_prototypes:
                - uuid: 008f679334694be09b59c007e95198bc
                  expression: '{$IFCONTROL:"{#IFNAME}"}=1 and last(/VM Linux by Agent/vfs.file.contents["/sys/class/net/{#IFNAME}/operstate"])=2 and (last(/VM Linux by Agent/vfs.file.contents["/sys/class/net/{#IFNAME}/operstate"],#1)<>last(/VM Linux by Agent/vfs.file.contents["/sys/class/net/{#IFNAME}/operstate"],#2))'
                  recovery_mode: RECOVERY_EXPRESSION
                  recovery_expression: 'last(/VM Linux by Agent/vfs.file.contents["/sys/class/net/{#IFNAME}/operstate"])<>2 or {$IFCONTROL:"{#IFNAME}"}=0'
                  name: 'Interface {#IFNAME}: Link down'
                  opdata: 'Current state: {ITEM.LASTVALUE1}'
                  priority: AVERAGE
                  description: |
                    This trigger expression works as follows:
                    1. It can be triggered if the operations status is down.
                    2. `{$IFCONTROL:"{#IFNAME}"}=1` - a user can redefine context macro to value - 0. That marks this interface as not important. No new trigger will be fired if this interface is down.
                    3. `{TEMPLATE_NAME:METRIC.diff()}=1` - the trigger fires only if the operational status was up to (1) sometime before (so, do not fire for the 'eternal off' interfaces.)
                    
                    WARNING: if closed manually - it will not fire again on the next poll, because of .diff.
                  manual_close: 'YES'
                  tags:
                    - tag: scope
                      value: availability
            - uuid: 68e99a2cb5494b0081aac39b9b3beb35
              name: 'Interface {#IFNAME}: Speed'
              key: 'vfs.file.contents["/sys/class/net/{#IFNAME}/speed"]'
              delay: 5m
              history: 7d
              trends: '0'
              units: bps
              description: |
                It indicates the latest or current speed value of the interface. The value is an integer representing the link speed expressed in bits/sec.
                This attribute is only valid for the interfaces that implement the ethtool `get_link_ksettings` method (mostly Ethernet).
                
                Reference: https://www.kernel.org/doc/Documentation/ABI/testing/sysfs-class-net
              preprocessing:
                - type: MULTIPLIER
                  parameters:
                    - '1000000'
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              tags:
                - tag: component
                  value: network
                - tag: interface
                  value: '{#IFNAME}'
            - uuid: 8000266b763c4cb8993c5485011f971c
              name: 'Interface {#IFNAME}: Interface type'
              key: 'vfs.file.contents["/sys/class/net/{#IFNAME}/type"]'
              delay: 1h
              history: 7d
              trends: '0'
              description: |
                It indicates the interface protocol type as a decimal value.
                See `include/uapi/linux/if_arp.h` for all possible values.
                Reference: https://www.kernel.org/doc/Documentation/ABI/testing/sysfs-class-net
              valuemap:
                name: 'Linux::Interface protocol types'
              preprocessing:
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1d
              tags:
                - tag: component
                  value: network
                - tag: interface
                  value: '{#IFNAME}'
          trigger_prototypes:
            - uuid: cd03c27e77c345a3ac21e37c33b2b494
              expression: |
                change(/VM Linux by Agent/vfs.file.contents["/sys/class/net/{#IFNAME}/speed"])<0 and last(/VM Linux by Agent/vfs.file.contents["/sys/class/net/{#IFNAME}/speed"])>0
                and
                (last(/VM Linux by Agent/vfs.file.contents["/sys/class/net/{#IFNAME}/type"])=6 or last(/VM Linux by Agent/vfs.file.contents["/sys/class/net/{#IFNAME}/type"])=1)
                and
                (last(/VM Linux by Agent/vfs.file.contents["/sys/class/net/{#IFNAME}/operstate"])<>2)
              recovery_mode: RECOVERY_EXPRESSION
              recovery_expression: |
                (change(/VM Linux by Agent/vfs.file.contents["/sys/class/net/{#IFNAME}/speed"])>0 and last(/VM Linux by Agent/vfs.file.contents["/sys/class/net/{#IFNAME}/speed"],#2)>0) or
                (last(/VM Linux by Agent/vfs.file.contents["/sys/class/net/{#IFNAME}/operstate"])=2)
              name: 'Interface {#IFNAME}: Ethernet has changed to lower speed than it was before'
              opdata: 'Current reported speed: {ITEM.LASTVALUE1}'
              priority: INFO
              description: 'This Ethernet connection has transitioned down from its known maximum speed. This might be a sign of autonegotiation issues. Acknowledge to close the problem manually.'
              manual_close: 'YES'
              dependencies:
                - name: 'Interface {#IFNAME}: Link down'
                  expression: '{$IFCONTROL:"{#IFNAME}"}=1 and last(/VM Linux by Agent/vfs.file.contents["/sys/class/net/{#IFNAME}/operstate"])=2 and (last(/VM Linux by Agent/vfs.file.contents["/sys/class/net/{#IFNAME}/operstate"],#1)<>last(/VM Linux by Agent/vfs.file.contents["/sys/class/net/{#IFNAME}/operstate"],#2))'
                  recovery_expression: 'last(/VM Linux by Agent/vfs.file.contents["/sys/class/net/{#IFNAME}/operstate"])<>2 or {$IFCONTROL:"{#IFNAME}"}=0'
              tags:
                - tag: scope
                  value: performance
            - uuid: 7693d424944a41e788beaacd33548b11
              expression: |
                (avg(/VM Linux by Agent/net.if.in["{#IFNAME}"],15m)>({$IF.UTIL.MAX:"{#IFNAME}"}/100)*last(/VM Linux by Agent/vfs.file.contents["/sys/class/net/{#IFNAME}/speed"]) or
                avg(/VM Linux by Agent/net.if.out["{#IFNAME}"],15m)>({$IF.UTIL.MAX:"{#IFNAME}"}/100)*last(/VM Linux by Agent/vfs.file.contents["/sys/class/net/{#IFNAME}/speed"])) and
                last(/VM Linux by Agent/vfs.file.contents["/sys/class/net/{#IFNAME}/speed"])>0
              recovery_mode: RECOVERY_EXPRESSION
              recovery_expression: |
                avg(/VM Linux by Agent/net.if.in["{#IFNAME}"],15m)<(({$IF.UTIL.MAX:"{#IFNAME}"}-3)/100)*last(/VM Linux by Agent/vfs.file.contents["/sys/class/net/{#IFNAME}/speed"]) and
                avg(/VM Linux by Agent/net.if.out["{#IFNAME}"],15m)<(({$IF.UTIL.MAX:"{#IFNAME}"}-3)/100)*last(/VM Linux by Agent/vfs.file.contents["/sys/class/net/{#IFNAME}/speed"])
              name: 'Interface {#IFNAME}: High bandwidth usage'
              event_name: 'Interface {#IFNAME}: High bandwidth usage (>{$IF.UTIL.MAX:"{#IFNAME}"}%)'
              opdata: 'In: {ITEM.LASTVALUE1}, out: {ITEM.LASTVALUE3}, speed: {ITEM.LASTVALUE2}'
              priority: WARNING
              description: 'The utilization of the network interface is close to its estimated maximum bandwidth.'
              manual_close: 'YES'
              dependencies:
                - name: 'Interface {#IFNAME}: Link down'
                  expression: '{$IFCONTROL:"{#IFNAME}"}=1 and last(/VM Linux by Agent/vfs.file.contents["/sys/class/net/{#IFNAME}/operstate"])=2 and (last(/VM Linux by Agent/vfs.file.contents["/sys/class/net/{#IFNAME}/operstate"],#1)<>last(/VM Linux by Agent/vfs.file.contents["/sys/class/net/{#IFNAME}/operstate"],#2))'
                  recovery_expression: 'last(/VM Linux by Agent/vfs.file.contents["/sys/class/net/{#IFNAME}/operstate"])<>2 or {$IFCONTROL:"{#IFNAME}"}=0'
              tags:
                - tag: scope
                  value: performance
            - uuid: 290cdba9513e4e9bafb06aba1c339dee
              expression: |
                min(/VM Linux by Agent/net.if.in["{#IFNAME}",errors],5m)>{$IF.ERRORS.WARN:"{#IFNAME}"}
                or min(/VM Linux by Agent/net.if.out["{#IFNAME}",errors],5m)>{$IF.ERRORS.WARN:"{#IFNAME}"}
              recovery_mode: RECOVERY_EXPRESSION
              recovery_expression: |
                max(/VM Linux by Agent/net.if.in["{#IFNAME}",errors],5m)<{$IF.ERRORS.WARN:"{#IFNAME}"}*0.8
                and max(/VM Linux by Agent/net.if.out["{#IFNAME}",errors],5m)<{$IF.ERRORS.WARN:"{#IFNAME}"}*0.8
              name: 'Interface {#IFNAME}: High error rate'
              event_name: 'Interface {#IFNAME}: High error rate (>{$IF.ERRORS.WARN:"{#IFNAME}"} for 5m)'
              opdata: 'errors in: {ITEM.LASTVALUE1}, errors out: {ITEM.LASTVALUE2}'
              priority: WARNING
              description: 'It recovers when it is below 80% of the `{$IF.ERRORS.WARN:"{#IFNAME}"}` threshold.'
              manual_close: 'YES'
              dependencies:
                - name: 'Interface {#IFNAME}: Link down'
                  expression: '{$IFCONTROL:"{#IFNAME}"}=1 and last(/VM Linux by Agent/vfs.file.contents["/sys/class/net/{#IFNAME}/operstate"])=2 and (last(/VM Linux by Agent/vfs.file.contents["/sys/class/net/{#IFNAME}/operstate"],#1)<>last(/VM Linux by Agent/vfs.file.contents["/sys/class/net/{#IFNAME}/operstate"],#2))'
                  recovery_expression: 'last(/VM Linux by Agent/vfs.file.contents["/sys/class/net/{#IFNAME}/operstate"])<>2 or {$IFCONTROL:"{#IFNAME}"}=0'
              tags:
                - tag: scope
                  value: availability
                - tag: scope
                  value: performance
        - uuid: d566fab1c123423ca932eb025c69869e
          name: 'Block devices discovery'
          key: vfs.dev.discovery
          delay: 1h
          filter:
            evaltype: AND
            conditions:
              - macro: '{#DEVTYPE}'
                value: disk
                formulaid: C
              - macro: '{#DEVNAME}'
                value: '{$VFS.DEV.DEVNAME.MATCHES}'
                formulaid: A
              - macro: '{#DEVNAME}'
                value: '{$VFS.DEV.DEVNAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: B
          item_prototypes:
            - uuid: 0117be276e794bf583c37af0424eff49
              name: '{#DEVNAME}: Disk average queue size (avgqu-sz)'
              type: DEPENDENT
              key: 'vfs.dev.queue_size[{#DEVNAME}]'
              delay: '0'
              history: 7d
              value_type: FLOAT
              description: 'The current average disk queue; the number of requests outstanding on the disk while the performance data is being collected.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$[10]'
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                - type: MULTIPLIER
                  parameters:
                    - '0.001'
              master_item:
                key: 'vfs.file.contents[/sys/block/{#DEVNAME}/stat]'
              tags:
                - tag: component
                  value: storage
                - tag: disk
                  value: '{#DEVNAME}'
            - uuid: a40108fc6d904d04bde6df79de7aca44
              name: '{#DEVNAME}: Disk read request avg waiting time (r_await)'
              type: CALCULATED
              key: 'vfs.dev.read.await[{#DEVNAME}]'
              history: 7d
              value_type: FLOAT
              units: '!ms'
              params: '(last(//vfs.dev.read.time.rate[{#DEVNAME}])/(last(//vfs.dev.read.rate[{#DEVNAME}])+(last(//vfs.dev.read.rate[{#DEVNAME}])=0)))*1000*(last(//vfs.dev.read.rate[{#DEVNAME}]) > 0)'
              description: 'This formula contains two Boolean expressions that evaluate to 1 or 0 in order to set the calculated metric to zero and to avoid the exception - division by zero.'
              tags:
                - tag: component
                  value: storage
                - tag: disk
                  value: '{#DEVNAME}'
            - uuid: ae0dc938a5bd4e32b00ca09e34480014
              name: '{#DEVNAME}: Disk read rate'
              type: DEPENDENT
              key: 'vfs.dev.read.rate[{#DEVNAME}]'
              delay: '0'
              history: 7d
              value_type: FLOAT
              units: '!r/s'
              description: 'r/s (read operations per second) - the number (after merges) of read requests completed per second for the device.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$[0]'
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
              master_item:
                key: 'vfs.file.contents[/sys/block/{#DEVNAME}/stat]'
              tags:
                - tag: component
                  value: storage
                - tag: disk
                  value: '{#DEVNAME}'
            - uuid: 5287dacd5b844b65bbbd0fba730e1065
              name: '{#DEVNAME}: Disk read time (rate)'
              type: DEPENDENT
              key: 'vfs.dev.read.time.rate[{#DEVNAME}]'
              delay: '0'
              history: 7d
              value_type: FLOAT
              description: 'The rate of total read time counter; used in `r_await` calculation.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$[3]'
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                - type: MULTIPLIER
                  parameters:
                    - '0.001'
              master_item:
                key: 'vfs.file.contents[/sys/block/{#DEVNAME}/stat]'
              tags:
                - tag: component
                  value: storage
                - tag: disk
                  value: '{#DEVNAME}'
            - uuid: d411f61e79174c4f93afbb157877ec3f
              name: '{#DEVNAME}: Disk utilization'
              type: DEPENDENT
              key: 'vfs.dev.util[{#DEVNAME}]'
              delay: '0'
              history: 7d
              value_type: FLOAT
              units: '%'
              description: 'This item is the percentage of elapsed time during which the selected disk drive was busy while servicing read or write requests.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$[9]'
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                - type: MULTIPLIER
                  parameters:
                    - '0.1'
              master_item:
                key: 'vfs.file.contents[/sys/block/{#DEVNAME}/stat]'
              tags:
                - tag: component
                  value: storage
                - tag: disk
                  value: '{#DEVNAME}'
            - uuid: 20dd00b9407d4438bce2e766e9bebea8
              name: '{#DEVNAME}: Disk write request avg waiting time (w_await)'
              type: CALCULATED
              key: 'vfs.dev.write.await[{#DEVNAME}]'
              history: 7d
              value_type: FLOAT
              units: '!ms'
              params: '(last(//vfs.dev.write.time.rate[{#DEVNAME}])/(last(//vfs.dev.write.rate[{#DEVNAME}])+(last(//vfs.dev.write.rate[{#DEVNAME}])=0)))*1000*(last(//vfs.dev.write.rate[{#DEVNAME}]) > 0)'
              description: 'This formula contains two Boolean expressions that evaluate to 1 or 0 in order to set the calculated metric to zero and to avoid the exception - division by zero.'
              tags:
                - tag: component
                  value: storage
                - tag: disk
                  value: '{#DEVNAME}'
            - uuid: 9cac667b9cdc464bbe997373adec2e5d
              name: '{#DEVNAME}: Disk write rate'
              type: DEPENDENT
              key: 'vfs.dev.write.rate[{#DEVNAME}]'
              delay: '0'
              history: 7d
              value_type: FLOAT
              units: '!w/s'
              description: 'w/s (write operations per second) - the number (after merges) of write requests completed per second for the device.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$[4]'
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
              master_item:
                key: 'vfs.file.contents[/sys/block/{#DEVNAME}/stat]'
              tags:
                - tag: component
                  value: storage
                - tag: disk
                  value: '{#DEVNAME}'
            - uuid: 293e7b56e0a6474c82ef74d8efe36bda
              name: '{#DEVNAME}: Disk write time (rate)'
              type: DEPENDENT
              key: 'vfs.dev.write.time.rate[{#DEVNAME}]'
              delay: '0'
              history: 7d
              value_type: FLOAT
              description: 'The rate of total write time counter; used in `w_await` calculation.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$[7]'
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                - type: MULTIPLIER
                  parameters:
                    - '0.001'
              master_item:
                key: 'vfs.file.contents[/sys/block/{#DEVNAME}/stat]'
              tags:
                - tag: component
                  value: storage
                - tag: disk
                  value: '{#DEVNAME}'
            - uuid: 3be5f64301c941a6a5da797c786c05f1
              name: '{#DEVNAME}: Get stats'
              key: 'vfs.file.contents[/sys/block/{#DEVNAME}/stat]'
              history: '0'
              trends: '0'
              value_type: TEXT
              description: 'The contents of get `/sys/block/{#DEVNAME}/stat` to get the disk statistics.'
              preprocessing:
                - type: JAVASCRIPT
                  parameters:
                    - 'return JSON.stringify(value.trim().split(/ +/));'
              tags:
                - tag: component
                  value: raw
          trigger_prototypes:
            - uuid: 5bb000faf15d4bb7a83ac6350f9a89b0
              expression: 'min(/VM Linux by Agent/vfs.dev.read.await[{#DEVNAME}],15m) > {$VFS.DEV.READ.AWAIT.WARN:"{#DEVNAME}"} or min(/VM Linux by Agent/vfs.dev.write.await[{#DEVNAME}],15m) > {$VFS.DEV.WRITE.AWAIT.WARN:"{#DEVNAME}"}'
              name: '{#DEVNAME}: Disk read/write request responses are too high'
              event_name: '{#DEVNAME}: Disk read/write request responses are too high (read > {$VFS.DEV.READ.AWAIT.WARN:"{#DEVNAME}"} ms for 15m or write > {$VFS.DEV.WRITE.AWAIT.WARN:"{#DEVNAME}"} ms for 15m)'
              priority: WARNING
              description: 'This trigger might indicate the disk `{#DEVNAME}` saturation.'
              manual_close: 'YES'
              tags:
                - tag: scope
                  value: performance
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
        - uuid: d89934c8b3a449efad31abde9ca5574f
          name: 'Mounted filesystem discovery'
          type: DEPENDENT
          key: vfs.fs.dependent.discovery
          delay: '0'
          filter:
            evaltype: AND
            conditions:
              - macro: '{#FSTYPE}'
                value: '{$VFS.FS.FSTYPE.MATCHES}'
                formulaid: C
              - macro: '{#FSTYPE}'
                value: '{$VFS.FS.FSTYPE.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: D
              - macro: '{#FSNAME}'
                value: '{$VFS.FS.FSNAME.MATCHES}'
                formulaid: A
              - macro: '{#FSNAME}'
                value: '{$VFS.FS.FSNAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: B
          description: 'The discovery of mounted filesystems with different types.'
          item_prototypes:
            - uuid: 795e22c8748641f49d1b27356f0e3733
              name: '{#FSNAME}: Free inodes in %'
              type: DEPENDENT
              key: 'vfs.fs.dependent.inode[{#FSNAME},pfree]'
              delay: '0'
              history: 7d
              value_type: FLOAT
              units: '%'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.inodes.pfree
              master_item:
                key: 'vfs.fs.dependent[{#FSNAME},data]'
              tags:
                - tag: component
                  value: storage
                - tag: filesystem
                  value: '{#FSNAME}'
              trigger_prototypes:
                - uuid: 210fefd168354fbd9fcf992dca69e227
                  expression: 'min(/VM Linux by Agent/vfs.fs.dependent.inode[{#FSNAME},pfree],5m)<{$VFS.FS.INODE.PFREE.MIN.CRIT:"{#FSNAME}"}'
                  name: '{#FSNAME}: Running out of free inodes'
                  event_name: '{#FSNAME}: Running out of free inodes (free < {$VFS.FS.INODE.PFREE.MIN.CRIT:"{#FSNAME}"}%)'
                  opdata: 'Free inodes: {ITEM.LASTVALUE1}'
                  priority: AVERAGE
                  description: |
                    It may become impossible to write to a disk if there are no index nodes left.
                    The following error messages may be returned as symptoms, even though the free space is available:
                    - 'No space left on device';
                    - 'Disk is full'.
                  tags:
                    - tag: scope
                      value: capacity
                    - tag: scope
                      value: performance
                - uuid: 7160b0f61bd747c2b029d61cdb2abe68
                  expression: 'min(/VM Linux by Agent/vfs.fs.dependent.inode[{#FSNAME},pfree],5m)<{$VFS.FS.INODE.PFREE.MIN.WARN:"{#FSNAME}"}'
                  name: '{#FSNAME}: Running out of free inodes'
                  event_name: '{#FSNAME}: Running out of free inodes (free < {$VFS.FS.INODE.PFREE.MIN.WARN:"{#FSNAME}"}%)'
                  opdata: 'Free inodes: {ITEM.LASTVALUE1}'
                  priority: WARNING
                  description: |
                    It may become impossible to write to a disk if there are no index nodes left.
                    The following error messages may be returned as symptoms, even though the free space is available:
                    - 'No space left on device';
                    - 'Disk is full'.
                  dependencies:
                    - name: '{#FSNAME}: Running out of free inodes'
                      expression: 'min(/VM Linux by Agent/vfs.fs.dependent.inode[{#FSNAME},pfree],5m)<{$VFS.FS.INODE.PFREE.MIN.CRIT:"{#FSNAME}"}'
                  tags:
                    - tag: scope
                      value: capacity
                    - tag: scope
                      value: performance
            - uuid: 952102fe6dbf43b28f8a1f093339185e
              name: '{#FSNAME}: Space utilization'
              type: DEPENDENT
              key: 'vfs.fs.dependent.size[{#FSNAME},pused]'
              delay: '0'
              history: 7d
              value_type: FLOAT
              units: '%'
              description: 'Space utilization expressed in % for `{#FSNAME}`.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.bytes.pused
              master_item:
                key: 'vfs.fs.dependent[{#FSNAME},data]'
              tags:
                - tag: component
                  value: storage
                - tag: filesystem
                  value: '{#FSNAME}'
            - uuid: 1634239df6d644acb61a551cd8ae1104
              name: '{#FSNAME}: Total space'
              type: DEPENDENT
              key: 'vfs.fs.dependent.size[{#FSNAME},total]'
              delay: '0'
              history: 7d
              units: B
              description: 'The total space expressed in bytes.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.bytes.total
              master_item:
                key: 'vfs.fs.dependent[{#FSNAME},data]'
              tags:
                - tag: component
                  value: storage
                - tag: filesystem
                  value: '{#FSNAME}'
            - uuid: 3f35028f1d2a432da8605a045c64651e
              name: '{#FSNAME}: Used space'
              type: DEPENDENT
              key: 'vfs.fs.dependent.size[{#FSNAME},used]'
              delay: '0'
              history: 7d
              units: B
              description: 'Used storage expressed in bytes.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.bytes.used
              master_item:
                key: 'vfs.fs.dependent[{#FSNAME},data]'
              tags:
                - tag: component
                  value: storage
                - tag: filesystem
                  value: '{#FSNAME}'
            - uuid: 0342ec531b96453b8d6772096f1b78e8
              name: '{#FSNAME}: Get filesystem data'
              type: DEPENDENT
              key: 'vfs.fs.dependent[{#FSNAME},data]'
              delay: '0'
              history: 1h
              trends: '0'
              value_type: TEXT
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.[?(@.fsname==''{#FSNAME}'')].first()'
              master_item:
                key: vfs.fs.get
              tags:
                - tag: component
                  value: raw
                - tag: component
                  value: storage
                - tag: filesystem
                  value: '{#FSNAME}'
            - uuid: ea56fd9181544c7d8452420215e6176c
              name: '{#FSNAME}: Filesystem is read-only'
              type: DEPENDENT
              key: 'vfs.fs.dependent[{#FSNAME},readonly]'
              delay: '0'
              history: 7d
              description: 'The filesystem is mounted as read-only. It is available only for ZOps agents 6.4 and higher.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.options
                  error_handler: DISCARD_VALUE
                - type: REGEX
                  parameters:
                    - '(?:^|,)ro\b'
                    - '1'
                  error_handler: CUSTOM_VALUE
                  error_handler_params: '0'
              master_item:
                key: 'vfs.fs.dependent[{#FSNAME},data]'
              tags:
                - tag: component
                  value: storage
                - tag: filesystem
                  value: '{#FSNAME}'
              trigger_prototypes:
                - uuid: 3bcd10cc067f489781b9a3138b3cc14f
                  expression: 'last(/VM Linux by Agent/vfs.fs.dependent[{#FSNAME},readonly],#2)=0 and last(/VM Linux by Agent/vfs.fs.dependent[{#FSNAME},readonly])=1'
                  recovery_mode: RECOVERY_EXPRESSION
                  recovery_expression: 'last(/VM Linux by Agent/vfs.fs.dependent[{#FSNAME},readonly])=0'
                  name: '{#FSNAME}: Filesystem has become read-only'
                  priority: AVERAGE
                  description: 'The filesystem has become read-only. A possible reason is an I/O error. It is available only for ZOps agents 6.4 and higher.'
                  manual_close: 'YES'
                  tags:
                    - tag: scope
                      value: availability
                    - tag: scope
                      value: performance
          trigger_prototypes:
            - uuid: de2ccd59309d45c89af13ebe6e4c4328
              expression: |
                last(/VM Linux by Agent/vfs.fs.dependent.size[{#FSNAME},pused])>{$VFS.FS.PUSED.MAX.CRIT:"{#FSNAME}"} and
                ((last(/VM Linux by Agent/vfs.fs.dependent.size[{#FSNAME},total])-last(/VM Linux by Agent/vfs.fs.dependent.size[{#FSNAME},used]))<{$VFS.FS.FREE.MIN.CRIT:"{#FSNAME}"} or timeleft(/VM Linux by Agent/vfs.fs.dependent.size[{#FSNAME},pused],1h,100)<1d)
              name: '{#FSNAME}: Disk space is critically low'
              event_name: '{#FSNAME}: Disk space is critically low (used > {$VFS.FS.PUSED.MAX.CRIT:"{#FSNAME}"}%)'
              opdata: 'Space used: {ITEM.LASTVALUE3} of {ITEM.LASTVALUE2} ({ITEM.LASTVALUE1})'
              priority: AVERAGE
              description: |
                Two conditions should match:
                1. The first condition - utilization of the space should be above `{$VFS.FS.PUSED.MAX.CRIT:"{#FSNAME}"}`.
                2. The second condition should be one of the following:
                - the disk free space is less than `{$VFS.FS.FREE.MIN.CRIT:"{#FSNAME}"}`;
                - the disk will be full in less than 24 hours.
              manual_close: 'YES'
              tags:
                - tag: scope
                  value: availability
                - tag: scope
                  value: capacity
            - uuid: 72af51e49696480d919ed71d017f8b73
              expression: |
                last(/VM Linux by Agent/vfs.fs.dependent.size[{#FSNAME},pused])>{$VFS.FS.PUSED.MAX.WARN:"{#FSNAME}"} and
                ((last(/VM Linux by Agent/vfs.fs.dependent.size[{#FSNAME},total])-last(/VM Linux by Agent/vfs.fs.dependent.size[{#FSNAME},used]))<{$VFS.FS.FREE.MIN.WARN:"{#FSNAME}"} or timeleft(/VM Linux by Agent/vfs.fs.dependent.size[{#FSNAME},pused],1h,100)<1d)
              name: '{#FSNAME}: Disk space is low'
              event_name: '{#FSNAME}: Disk space is low (used > {$VFS.FS.PUSED.MAX.WARN:"{#FSNAME}"}%)'
              opdata: 'Space used: {ITEM.LASTVALUE3} of {ITEM.LASTVALUE2} ({ITEM.LASTVALUE1})'
              priority: WARNING
              description: |
                Two conditions should match:
                1. The first condition - utilization of the space should be above `{$VFS.FS.PUSED.MAX.WARN:"{#FSNAME}"}`.
                2. The second condition should be one of the following:
                - the disk free space is less than `{$VFS.FS.FREE.MIN.WARN:"{#FSNAME}"}`;
                - the disk will be full in less than 24 hours.
              manual_close: 'YES'
              dependencies:
                - name: '{#FSNAME}: Disk space is critically low'
                  expression: |
                    last(/VM Linux by Agent/vfs.fs.dependent.size[{#FSNAME},pused])>{$VFS.FS.PUSED.MAX.CRIT:"{#FSNAME}"} and
                    ((last(/VM Linux by Agent/vfs.fs.dependent.size[{#FSNAME},total])-last(/VM Linux by Agent/vfs.fs.dependent.size[{#FSNAME},used]))<{$VFS.FS.FREE.MIN.CRIT:"{#FSNAME}"} or timeleft(/VM Linux by Agent/vfs.fs.dependent.size[{#FSNAME},pused],1h,100)<1d)
              tags:
                - tag: scope
                  value: availability
                - tag: scope
                  value: capacity
          master_item:
            key: vfs.fs.get
          lld_macro_paths:
            - lld_macro: '{#FSNAME}'
              path: $.fsname
            - lld_macro: '{#FSTYPE}'
              path: $.fstype
          overrides:
            - name: 'Skip metadata collection for dynamic FS'
              step: '1'
              filter:
                conditions:
                  - macro: '{#FSTYPE}'
                    value: ^(btrfs|zfs)$
                    formulaid: A
              operations:
                - operationobject: ITEM_PROTOTYPE
                  operator: LIKE
                  value: inode
                  discover: NO_DISCOVER
      tags:
        - tag: class
          value: os
        - tag: target
          value: linux
      macros:
        - macro: '{$AGENT.TIMEOUT}'
          value: 3m
          description: 'Timeout after which agent is considered unavailable. Works only for agents reachable from ZOps server/proxy (passive mode).'
        - macro: '{$CPU.UTIL.CRIT}'
          value: '90'
        - macro: '{$IF.ERRORS.WARN}'
          value: '2'
        - macro: '{$IF.UTIL.MAX}'
          value: '90'
          description: 'This macro is used as a threshold in the interface utilization trigger.'
        - macro: '{$IFCONTROL}'
          value: '1'
        - macro: '{$KERNEL.MAXFILES.MIN}'
          value: '256'
        - macro: '{$KERNEL.MAXPROC.MIN}'
          value: '1024'
        - macro: '{$LOAD_AVG_PER_CPU.MAX.WARN}'
          value: '1.5'
          description: 'The CPU load per core is considered sustainable. If necessary, it can be tuned.'
        - macro: '{$MEMORY.AVAILABLE.MIN}'
          value: 20M
          description: 'This macro is used as a threshold in the memory available trigger.'
        - macro: '{$MEMORY.UTIL.MAX}'
          value: '90'
          description: 'This macro is used as a threshold in the memory utilization trigger.'
        - macro: '{$NET.IF.IFNAME.MATCHES}'
          value: '^.*$'
        - macro: '{$NET.IF.IFNAME.NOT_MATCHES}'
          value: '(^Software Loopback Interface|^NULL[0-9.]*$|^[Ll]o[0-9.]*$|^[Ss]ystem$|^Nu[0-9.]*$|^veth[0-9A-z]+$|docker[0-9]+|br-[a-z0-9]{12})'
          description: 'It filters out `loopbacks`, `nulls`, `docker veth` links and `docker0 bridge` by default.'
        - macro: '{$SWAP.PFREE.MIN.WARN}'
          value: '50'
        - macro: '{$SYSTEM.FUZZYTIME.MAX}'
          value: '60'
        - macro: '{$VFS.DEV.DEVNAME.MATCHES}'
          value: .+
          description: 'This macro is used for a discovery of block devices. It can be overridden on host level or its linked template level.'
        - macro: '{$VFS.DEV.DEVNAME.NOT_MATCHES}'
          value: '^(loop[0-9]*|sd[a-z][0-9]+|nbd[0-9]+|sr[0-9]+|fd[0-9]+|dm-[0-9]+|ram[0-9]+|ploop[a-z0-9]+|md[0-9]*|hcp[0-9]*|zram[0-9]*)'
          description: 'This macro is used for a discovery of block devices. It can be overridden on host level or its linked template level.'
        - macro: '{$VFS.DEV.READ.AWAIT.WARN}'
          value: '20'
          description: 'The average response time (in ms) of disk read before the trigger would fire.'
        - macro: '{$VFS.DEV.WRITE.AWAIT.WARN}'
          value: '20'
          description: 'The average response time (in ms) of disk write before the trigger would fire.'
        - macro: '{$VFS.FS.FREE.MIN.CRIT}'
          value: 5G
          description: 'The critical threshold for utilization of the filesystem.'
        - macro: '{$VFS.FS.FREE.MIN.WARN}'
          value: 10G
          description: 'The warning threshold for utilization of the filesystem.'
        - macro: '{$VFS.FS.FSNAME.MATCHES}'
          value: .+
          description: 'This macro is used for discovery of the filesystems. It can be overridden on host level or its linked template level.'
        - macro: '{$VFS.FS.FSNAME.NOT_MATCHES}'
          value: ^(/dev|/sys|/run|/proc|.+/shm$)
          description: 'This macro is used for discovery of the filesystems. It can be overridden on host level or its linked template level.'
        - macro: '{$VFS.FS.FSTYPE.MATCHES}'
          value: ^(btrfs|ext2|ext3|ext4|reiser|xfs|ffs|ufs|jfs|jfs2|vxfs|hfs|apfs|refs|ntfs|fat32|zfs)$
          description: 'This macro is used for discovery of the filesystems. It can be overridden on host level or its linked template level.'
        - macro: '{$VFS.FS.FSTYPE.NOT_MATCHES}'
          value: ^\s$
          description: 'This macro is used for discovery of the filesystems. It can be overridden on host level or its linked template level.'
        - macro: '{$VFS.FS.INODE.PFREE.MIN.CRIT}'
          value: '10'
          description: 'The critical threshold of the filesystem metadata utilization.'
        - macro: '{$VFS.FS.INODE.PFREE.MIN.WARN}'
          value: '20'
          description: 'The warning threshold of the filesystem metadata utilization.'
        - macro: '{$VFS.FS.PUSED.MAX.CRIT}'
          value: '90'
          description: 'The critical threshold of the filesystem utilization.'
        - macro: '{$VFS.FS.PUSED.MAX.WARN}'
          value: '80'
          description: 'The warning threshold of the filesystem utilization.'
      valuemaps:
        - uuid: 4118780551d3414b8b85a736603f13de
          name: ifOperStatus
          mappings:
            - value: '0'
              newvalue: unknown
            - value: '1'
              newvalue: notpresent
            - value: '2'
              newvalue: down
            - value: '3'
              newvalue: lowerlayerdown
            - value: '4'
              newvalue: testing
            - value: '5'
              newvalue: dormant
            - value: '6'
              newvalue: up
        - uuid: 4c4796f729b34ac889a9a87f3c897f4e
          name: 'Linux::Interface protocol types'
          mappings:
            - value: '0'
              newvalue: 'from KA9Q: NET/ROM pseudo'
            - value: '1'
              newvalue: Ethernet
            - value: '2'
              newvalue: 'Experimental Ethernet'
            - value: '3'
              newvalue: 'AX.25 Level 2'
            - value: '4'
              newvalue: 'PROnet token ring'
            - value: '5'
              newvalue: Chaosnet
            - value: '6'
              newvalue: 'IEEE 802.2 Ethernet/TR/TB'
            - value: '7'
              newvalue: ARCnet
            - value: '8'
              newvalue: APPLEtalk
            - value: '15'
              newvalue: 'Frame Relay DLCI'
            - value: '19'
              newvalue: ATM
            - value: '23'
              newvalue: 'Metricom STRIP (new IANA id)'
            - value: '24'
              newvalue: 'IEEE 1394 IPv4 - RFC 2734'
            - value: '27'
              newvalue: EUI-64
            - value: '32'
              newvalue: InfiniBand
            - value: '256'
              newvalue: ARPHRD_SLIP
            - value: '257'
              newvalue: ARPHRD_CSLIP
            - value: '258'
              newvalue: ARPHRD_SLIP6
            - value: '259'
              newvalue: ARPHRD_CSLIP6
            - value: '260'
              newvalue: 'Notional KISS type'
            - value: '264'
              newvalue: ARPHRD_ADAPT
            - value: '270'
              newvalue: ARPHRD_ROSE
            - value: '271'
              newvalue: 'CCITT X.25'
            - value: '272'
              newvalue: 'Boards with X.25 in firmware'
            - value: '280'
              newvalue: 'Controller Area Network'
            - value: '512'
              newvalue: ARPHRD_PPP
            - value: '513'
              newvalue: 'Cisco HDLC'
            - value: '516'
              newvalue: LAPB
            - value: '517'
              newvalue: 'Digital''s DDCMP protocol'
            - value: '518'
              newvalue: 'Raw HDLC'
            - value: '519'
              newvalue: 'Raw IP'
            - value: '768'
              newvalue: 'IPIP tunnel'
            - value: '769'
              newvalue: 'IP6IP6 tunnel'
            - value: '770'
              newvalue: 'Frame Relay Access Device'
            - value: '771'
              newvalue: 'SKIP vif'
            - value: '772'
              newvalue: 'Loopback device'
            - value: '773'
              newvalue: 'Localtalk device'
            - value: '774'
              newvalue: 'Fiber Distributed Data Interface'
            - value: '775'
              newvalue: 'AP1000 BIF'
            - value: '776'
              newvalue: 'sit0 device - IPv6-in-IPv4'
            - value: '777'
              newvalue: 'IP over DDP tunneller'
            - value: '778'
              newvalue: 'GRE over IP'
            - value: '779'
              newvalue: 'PIMSM register interface'
            - value: '780'
              newvalue: 'High Performance Parallel Interface'
            - value: '781'
              newvalue: 'Nexus 64Mbps Ash'
            - value: '782'
              newvalue: 'Acorn Econet'
            - value: '783'
              newvalue: Linux-IrDA
            - value: '784'
              newvalue: 'Point to point fibrechannel'
            - value: '785'
              newvalue: 'Fibrechannel arbitrated loop'
            - value: '786'
              newvalue: 'Fibrechannel public loop'
            - value: '787'
              newvalue: 'Fibrechannel fabric'
            - value: '800'
              newvalue: 'Magic type ident for TR'
            - value: '801'
              newvalue: 'IEEE 802.11'
            - value: '802'
              newvalue: 'IEEE 802.11 + Prism2 header'
            - value: '803'
              newvalue: 'IEEE 802.11 + radiotap header'
            - value: '804'
              newvalue: ARPHRD_IEEE802154
            - value: '805'
              newvalue: 'IEEE 802.15.4 network monitor'
            - value: '820'
              newvalue: 'PhoNet media type'
            - value: '821'
              newvalue: 'PhoNet pipe header'
            - value: '822'
              newvalue: 'CAIF media type'
            - value: '823'
              newvalue: 'GRE over IPv6'
            - value: '824'
              newvalue: 'Netlink header'
            - value: '825'
              newvalue: 'IPv6 over LoWPAN'
            - value: '826'
              newvalue: 'Vsock monitor header'
        - uuid: 6ebc3fcfa06d46fabd778bc83b3f275d
          name: ZOps.host.available
          mappings:
            - value: '0'
              newvalue: 'not available'
            - value: '1'
              newvalue: available
            - value: '2'
              newvalue: unknown
        - uuid: 2fe9869d1fa44ec9a168412946ad7e06
          name: 'ZOps agent ping status'
          mappings:
            - value: '1'
              newvalue: Up
  triggers:
    - uuid: 86bbeaffa4284dce9e261227a16f1aed
      expression: 'last(/VM Linux by Agent/proc.num)/last(/VM Linux by Agent/kernel.maxproc)*100>80'
      name: 'Getting closer to process limit'
      event_name: 'Getting closer to process limit (over 80% used)'
      opdata: '{ITEM.LASTVALUE1} active, {ITEM.LASTVALUE2} limit.'
      priority: WARNING
      tags:
        - tag: scope
          value: performance
    - uuid: 957576bdda6849e3a31cc34467dcbf77
      expression: 'max(/VM Linux by Agent/system.swap.size[,pfree],5m)<{$SWAP.PFREE.MIN.WARN} and last(/VM Linux by Agent/system.swap.size[,total])>0'
      name: 'High swap space usage'
      event_name: 'High swap space usage (less than {$SWAP.PFREE.MIN.WARN}% free)'
      opdata: 'Free: {ITEM.LASTVALUE1}, total: {ITEM.LASTVALUE2}'
      priority: WARNING
      description: 'If there is no swap configured, this trigger is ignored.'
      dependencies:
        - name: 'High memory utilization'
          expression: 'min(/VM Linux by Agent/vm.memory.utilization,5m)>{$MEMORY.UTIL.MAX}'
        - name: 'Lack of available memory'
          expression: 'max(/VM Linux by Agent/vm.memory.size[available],5m)<{$MEMORY.AVAILABLE.MIN} and last(/VM Linux by Agent/vm.memory.size[total])>0'
      tags:
        - tag: scope
          value: capacity
    - uuid: 691cd3c6760546ecb2556cdf3f2f414d
      expression: 'max(/VM Linux by Agent/vm.memory.size[available],5m)<{$MEMORY.AVAILABLE.MIN} and last(/VM Linux by Agent/vm.memory.size[total])>0'
      name: 'Lack of available memory'
      event_name: 'Lack of available memory (<{$MEMORY.AVAILABLE.MIN} of {ITEM.VALUE2})'
      opdata: 'Available: {ITEM.LASTVALUE1}, total: {ITEM.LASTVALUE2}'
      priority: AVERAGE
      tags:
        - tag: scope
          value: capacity
        - tag: scope
          value: performance
    - uuid: 3c41207d8e5146d9be31f0d74c441b34
      expression: |
        min(/VM Linux by Agent/system.cpu.load[all,avg1],5m)/last(/VM Linux by Agent/system.cpu.num)>{$LOAD_AVG_PER_CPU.MAX.WARN}
        and last(/VM Linux by Agent/system.cpu.load[all,avg5])>0
        and last(/VM Linux by Agent/system.cpu.load[all,avg15])>0
      name: 'Load average is too high'
      event_name: 'Load average is too high (per CPU load over {$LOAD_AVG_PER_CPU.MAX.WARN} for 5m)'
      opdata: 'Load averages(1m 5m 15m): ({ITEM.LASTVALUE1} {ITEM.LASTVALUE3} {ITEM.LASTVALUE4}), # of CPUs: {ITEM.LASTVALUE2}'
      priority: AVERAGE
      description: 'The load average per CPU is too high. The system may be slow to respond.'
      tags:
        - tag: scope
          value: capacity
        - tag: scope
          value: performance