zabbix_export:
  version: '6.4'
  template_groups:
    - uuid: 162c8f84f1764ea49759dbc6fc04e43e
      name: Templates/Common
  templates:
    - uuid: 55876364cf0e42fc8f25908c5849273f
      template: 'Nutanix VM by HTTP'
      name: 'Nutanix VM by HTTP'
      description: 'Generated by Tognix'
      groups:
        - name: Templates/Common
      items:
        - uuid: 151a701742d342ac83f87d4ea8cbb784
          name: 'ICMP ping'
          type: SIMPLE
          key: icmpping
          history: 1w
          tags:
            - tag: component
              value: health
            - tag: component
              value: network
          triggers:
            - uuid: 09abb0df6a4e44efa83dfe17219a026b
              expression: 'max(/Nutanix VM by HTTP/icmpping,#3)=0'
              name: 'Unavailable by ICMP ping'
              priority: HIGH
              description: 'Last three attempts returned timeout.  Please check device connectivity.'
              tags:
                - tag: scope
                  value: availability
        - uuid: 174ffbb646714e32b7205132748df478
          name: 'ICMP loss'
          type: SIMPLE
          key: icmppingloss
          history: 1w
          value_type: FLOAT
          units: '%'
          tags:
            - tag: component
              value: health
            - tag: component
              value: network
          triggers:
            - uuid: 8103f5398d194080903b652df433964d
              expression: 'min(/Nutanix VM by HTTP/icmppingloss,5m)>{$ICMP_LOSS_WARN} and min(/Nutanix VM by HTTP/icmppingloss,5m)<100'
              name: 'High ICMP ping loss'
              opdata: 'Loss: {ITEM.LASTVALUE1}'
              priority: WARNING
              dependencies:
                - name: 'Unavailable by ICMP ping'
                  expression: 'max(/Nutanix VM by HTTP/icmpping,#3)=0'
              tags:
                - tag: scope
                  value: availability
                - tag: scope
                  value: performance
        - uuid: 18d02cd6bfc2466684360f28c0ecdf74
          name: 'ICMP response time'
          type: SIMPLE
          key: icmppingsec
          history: 1w
          value_type: FLOAT
          units: s
          tags:
            - tag: component
              value: health
            - tag: component
              value: network
          triggers:
            - uuid: 3aa6f5165628495c9947f039bc4de57b
              expression: 'avg(/Nutanix VM by HTTP/icmppingsec,5m)>{$ICMP_RESPONSE_TIME_WARN}'
              name: 'High ICMP ping response time'
              opdata: 'Value: {ITEM.LASTVALUE1}'
              priority: WARNING
              dependencies:
                - name: 'High ICMP ping loss'
                  expression: 'min(/Nutanix VM by HTTP/icmppingloss,5m)>{$ICMP_LOSS_WARN} and min(/Nutanix VM by HTTP/icmppingloss,5m)<100'
                - name: 'Unavailable by ICMP ping'
                  expression: 'max(/Nutanix VM by HTTP/icmpping,#3)=0'
              tags:
                - tag: scope
                  value: availability
                - tag: scope
                  value: performance
        - uuid: 11602065c7af419a9ef1948b77d2af29
          name: 'Nutanix: Get Values'
          type: HTTP_AGENT
          key: nutanix.get_vm_values
          history: 1h
          trends: '0'
          value_type: TEXT
          authtype: BASIC
          username: '{$NUTANIX.USER}'
          password: '{$NUTANIX.PASSWORD}'
          url: '{$NUTANIX.URL}'
          description: 'request  https://ip:port/PrismGateway/services/rest/v2.0/vms/uuid'
          tags:
            - tag: component
              value: raw        
        - uuid: 5094c2eaab874cf7bfed370154b6f9dd
          name: 'Online Status'
          type: DEPENDENT
          key: 'power_state'
          delay: '60'
          history: 7d
          trends: '0'
          value_type: CHAR
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.power_state
          master_item:
            key: 'nutanix.get_vm_values'
          tags:
            - tag: Application
              value: 'nutanix'
        - uuid: 05e128f3424047178a45fa2bbcd7dccf
          name: 'memory_mb'
          type: DEPENDENT
          key: 'memory_mb'
          delay: '60'
          history: 7d
          value_type: FLOAT
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.memory_mb
          master_item:
            key: 'nutanix.get_vm_values'
          tags:
            - tag: Application
              value: 'nutanix'
        - uuid: 010397257a66462892878c2ffbdf3cdc
          name: 'num_vcpus'
          type: DEPENDENT
          key: 'num_vcpus'
          delay: '60'
          history: 7d
          value_type: FLOAT
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.num_vcpus
          master_item:
            key: 'nutanix.get_vm_values'
          tags:
            - tag: Application
              value: 'nutanix'                                                                                                                                                                                                     
      macros:
        - macro: '{$SNMP_COMMUNITY}'
          value: public
        - macro: '{$NUTANIX.USER}'
          value: admin
        - macro: '{$NUTANIX.PASSWORD}'
          value: tognix
        - macro: '{$NUTANIX.URL}'
          value: 'https://ip:port/PrismGateway/services/rest/v2.0/hosts/uuid'
        - macro: '{$ICMP_LOSS_WARN}'
          value: '20'
        - macro: '{$ICMP_RESPONSE_TIME_WARN}'
          value: '0.15'
