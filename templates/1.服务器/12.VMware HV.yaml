zabbix_export:
  version: '6.4'
  template_groups:
    - uuid: a571c0d144b14fd4a87a9d9b2aa9fcd6
      name: Templates/Common
  templates:
    - uuid: 5899b2f0aced4085b5ac25d0461b3425
      template: 'VMware HV'
      name: 'VMware HV'
      description: 'Generated by official Zabbix template tool "Templator" 2.0.0'
      vendor:
        name: Zops
        version: 6.4-0
      groups:
        - name: Templates/Common
      items:
        - uuid: 2aca7f53ab4848cdafa90277146d6c20
          name: 'ICMP ping'
          type: SIMPLE
          key: icmpping
          history: 1w
          tags:
            - tag: component
              value: health
            - tag: component
              value: network
          triggers:
            - uuid: 0502c5f8e2514242bb4131bb8d7d76d4
              expression: 'max(/VMware HV/icmpping,#3)=0'
              name: 'Unavailable by ICMP ping'
              priority: HIGH
              description: 'Last three attempts returned timeout.  Please check device connectivity.'
              tags:
                - tag: scope
                  value: availability
        - uuid: 26b37dcd3f444362b8a41023291c9a0c
          name: 'ICMP loss'
          type: SIMPLE
          key: icmppingloss
          history: 1w
          value_type: FLOAT
          units: '%'
          tags:
            - tag: component
              value: health
            - tag: component
              value: network
          triggers:
            - uuid: 16f0896c50424dfaa52e8f519e3323f9
              expression: 'min(/VMware HV/icmppingloss,5m)>{$ICMP_LOSS_WARN} and min(/VMware HV/icmppingloss,5m)<100'
              name: 'High ICMP ping loss'
              opdata: 'Loss: {ITEM.LASTVALUE1}'
              priority: WARNING
              dependencies:
                - name: 'Unavailable by ICMP ping'
                  expression: 'max(/VMware HV/icmpping,#3)=0'
              tags:
                - tag: scope
                  value: availability
                - tag: scope
                  value: performance
        - uuid: 66425593dd7940f5af8f4f4f5070ddf2
          name: 'ICMP response time'
          type: SIMPLE
          key: icmppingsec
          history: 1w
          value_type: FLOAT
          units: s
          tags:
            - tag: component
              value: health
            - tag: component
              value: network
          triggers:
            - uuid: 1c57d62a77ca43dc98964691ad6bd056
              expression: 'avg(/VMware HV/icmppingsec,5m)>{$ICMP_RESPONSE_TIME_WARN}'
              name: 'High ICMP ping response time'
              opdata: 'Value: {ITEM.LASTVALUE1}'
              priority: WARNING
              dependencies:
                - name: 'High ICMP ping loss'
                  expression: 'min(/VMware HV/icmppingloss,5m)>{$ICMP_LOSS_WARN} and min(/VMware HV/icmppingloss,5m)<100'
                - name: 'Unavailable by ICMP ping'
                  expression: 'max(/VMware HV/icmpping,#3)=0'
              tags:
                - tag: scope
                  value: availability
                - tag: scope
                  value: performance
        - uuid: af4d0877fda84753816c817ad76162f1
          name: 'VMware: Cluster name'
          type: SIMPLE
          key: 'vmware.hv.cluster.name[{$VMWARE.URL},{$VMWARE.HV.UUID}]'
          delay: 1h
          history: 7d
          trends: '0'
          value_type: CHAR
          username: '{$VMWARE.USERNAME}'
          password: '{$VMWARE.PASSWORD}'
          description: 'Cluster name of the guest VM.'
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1d
          tags:
            - tag: component
              value: cluster
        - uuid: c4ebd62118464e7a8d1945f80d70f8ae
          name: 'VMware: CPU usage in percents'
          type: SIMPLE
          key: 'vmware.hv.cpu.usage.perf[{$VMWARE.URL},{$VMWARE.HV.UUID}]'
          history: 7d
          value_type: FLOAT
          units: '%'
          username: '{$VMWARE.USERNAME}'
          password: '{$VMWARE.PASSWORD}'
          description: 'CPU usage as a percentage during the interval.'
          tags:
            - tag: component
              value: cpu
        - uuid: 1bff6fbd300d4455a787a273d957bba3
          name: 'VMware: CPU usage'
          type: SIMPLE
          key: 'vmware.hv.cpu.usage[{$VMWARE.URL},{$VMWARE.HV.UUID}]'
          history: 7d
          units: Hz
          username: '{$VMWARE.USERNAME}'
          password: '{$VMWARE.PASSWORD}'
          description: 'Aggregated CPU usage across all cores on the host in Hz. This is only available if the host is connected.'
          tags:
            - tag: component
              value: cpu
        - uuid: aad168c33cd14f76aa14ab5ca26498ec
          name: 'VMware: CPU utilization'
          type: SIMPLE
          key: 'vmware.hv.cpu.utilization[{$VMWARE.URL},{$VMWARE.HV.UUID}]'
          history: 7d
          value_type: FLOAT
          units: '%'
          username: '{$VMWARE.USERNAME}'
          password: '{$VMWARE.PASSWORD}'
          description: 'CPU usage as a percentage during the interval depends on power management or HT.'
          tags:
            - tag: component
              value: cpu
        - uuid: e4d27d7f9b9048d4ae6c60cbdd6c0091
          name: 'VMware: Datacenter name'
          type: SIMPLE
          key: 'vmware.hv.datacenter.name[{$VMWARE.URL},{$VMWARE.HV.UUID}]'
          delay: 1h
          history: 7d
          trends: '0'
          value_type: CHAR
          username: '{$VMWARE.USERNAME}'
          password: '{$VMWARE.PASSWORD}'
          description: 'Datacenter name of the hypervisor.'
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1d
          tags:
            - tag: component
              value: datacenter
        - uuid: 5c29837f75f04d7f9a5786691b3dd991
          name: 'VMware: Full name'
          type: SIMPLE
          key: 'vmware.hv.fullname[{$VMWARE.URL},{$VMWARE.HV.UUID}]'
          delay: 1h
          history: 7d
          trends: '0'
          value_type: CHAR
          username: '{$VMWARE.USERNAME}'
          password: '{$VMWARE.PASSWORD}'
          description: 'The complete product name, including the version information.'
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1d
          tags:
            - tag: component
              value: system
        - uuid: ad0053d57b834e6a9776c08e1c455d55
          name: 'VMware: CPU frequency'
          type: SIMPLE
          key: 'vmware.hv.hw.cpu.freq[{$VMWARE.URL},{$VMWARE.HV.UUID}]'
          delay: 1h
          history: 7d
          units: Hz
          username: '{$VMWARE.USERNAME}'
          password: '{$VMWARE.PASSWORD}'
          description: 'The speed of the CPU cores. This is an average value if there are multiple speeds. The product of CPU frequency and number of cores is approximately equal to the sum of the MHz for all the individual cores on the host.'
          tags:
            - tag: component
              value: cpu
        - uuid: 3f0c35fcef9e4699ac5a1c51d80f8da4
          name: 'VMware: CPU model'
          type: SIMPLE
          key: 'vmware.hv.hw.cpu.model[{$VMWARE.URL},{$VMWARE.HV.UUID}]'
          delay: 1h
          history: 7d
          trends: '0'
          value_type: CHAR
          username: '{$VMWARE.USERNAME}'
          password: '{$VMWARE.PASSWORD}'
          description: 'The CPU model.'
          tags:
            - tag: component
              value: cpu
        - uuid: c99a5bf2e3904f97b3d361ca20af7883
          name: 'VMware: CPU cores'
          type: SIMPLE
          key: 'vmware.hv.hw.cpu.num[{$VMWARE.URL},{$VMWARE.HV.UUID}]'
          delay: 1h
          history: 7d
          username: '{$VMWARE.USERNAME}'
          password: '{$VMWARE.PASSWORD}'
          description: 'Number of physical CPU cores on the host. Physical CPU cores are the processors contained by a CPU package.'
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1d
          tags:
            - tag: component
              value: cpu
        - uuid: 89cb0a4809e7454a862f398a0e9d6bed
          name: 'VMware: CPU threads'
          type: SIMPLE
          key: 'vmware.hv.hw.cpu.threads[{$VMWARE.URL},{$VMWARE.HV.UUID}]'
          delay: 1h
          history: 7d
          username: '{$VMWARE.USERNAME}'
          password: '{$VMWARE.PASSWORD}'
          description: 'Number of physical CPU threads on the host.'
          tags:
            - tag: component
              value: cpu
        - uuid: ce89c38e6e5d4338a30ee150be1b2b67
          name: 'VMware: Total memory'
          type: SIMPLE
          key: 'vmware.hv.hw.memory[{$VMWARE.URL},{$VMWARE.HV.UUID}]'
          delay: 1h
          history: 7d
          units: B
          username: '{$VMWARE.USERNAME}'
          password: '{$VMWARE.PASSWORD}'
          description: 'The physical memory size.'
          tags:
            - tag: component
              value: memory
        - uuid: 7ed7ac26da384bcda976badf24ebbec1
          name: 'VMware: Model'
          type: SIMPLE
          key: 'vmware.hv.hw.model[{$VMWARE.URL},{$VMWARE.HV.UUID}]'
          delay: 1h
          history: 7d
          trends: '0'
          value_type: CHAR
          username: '{$VMWARE.USERNAME}'
          password: '{$VMWARE.PASSWORD}'
          description: 'The system model identification.'
          tags:
            - tag: component
              value: system
        - uuid: 6c4aab55b3e640779a25ac90b9ca2a43
          name: 'VMware: Bios UUID'
          type: SIMPLE
          key: 'vmware.hv.hw.uuid[{$VMWARE.URL},{$VMWARE.HV.UUID}]'
          delay: 1h
          history: 7d
          trends: '0'
          value_type: CHAR
          username: '{$VMWARE.USERNAME}'
          password: '{$VMWARE.PASSWORD}'
          description: 'The hardware BIOS identification.'
          tags:
            - tag: component
              value: system
        - uuid: aec06090d16d4bdd8ed3494b448f19d8
          name: 'VMware: Vendor'
          type: SIMPLE
          key: 'vmware.hv.hw.vendor[{$VMWARE.URL},{$VMWARE.HV.UUID}]'
          delay: 1h
          history: 7d
          trends: '0'
          value_type: CHAR
          username: '{$VMWARE.USERNAME}'
          password: '{$VMWARE.PASSWORD}'
          description: 'The hardware vendor identification.'
          tags:
            - tag: component
              value: system
        - uuid: 21020a79436a49c38caf8941f6b68da3
          name: 'VMware: Ballooned memory'
          type: SIMPLE
          key: 'vmware.hv.memory.size.ballooned[{$VMWARE.URL},{$VMWARE.HV.UUID}]'
          history: 7d
          units: B
          username: '{$VMWARE.USERNAME}'
          password: '{$VMWARE.PASSWORD}'
          description: 'The amount of guest physical memory that is currently reclaimed through the balloon driver. Sum of all guest VMs.'
          tags:
            - tag: component
              value: memory
        - uuid: 93d680d6886d446badbbe995ddd9ba9c
          name: 'VMware: Used memory'
          type: SIMPLE
          key: 'vmware.hv.memory.used[{$VMWARE.URL},{$VMWARE.HV.UUID}]'
          history: 7d
          units: B
          username: '{$VMWARE.USERNAME}'
          password: '{$VMWARE.PASSWORD}'
          description: 'Physical memory usage on the host.'
          tags:
            - tag: component
              value: memory
        - uuid: 1825a1585d7b4523b01dddebab92aeef
          name: 'Memory utilization'
          type: CALCULATED
          key: vmware.hv.memory.utilization
          history: 7d
          value_type: FLOAT
          units: '%'
          params: 'last(//vmware.hv.memory.used[{$VMWARE.URL},{$VMWARE.HV.UUID}]) / last(//vmware.hv.hw.memory[{$VMWARE.URL},{$VMWARE.HV.UUID}]) * 100'
          description: 'Memory utilization in %.'
          tags:
            - tag: component
              value: memory
          triggers:
            - uuid: 88b68e720d9d43f180b324386842fdf9
              expression: 'min(/VMware HV/vmware.hv.memory.utilization,5m)>{$MEMORY.UTIL.MAX}'
              name: 'High memory utilization'
              event_name: 'High memory utilization (>{$MEMORY.UTIL.MAX}% for 5m)'
              priority: AVERAGE
              description: 'The system is running out of free memory.'
              tags:
                - tag: scope
                  value: capacity
                - tag: scope
                  value: performance
        - uuid: 33f78ab6ee6c4e7585a83a60cdecab6f
          name: 'VMware: Bits received'
          type: SIMPLE
          key: 'vmware.hv.network.in[{$VMWARE.URL},{$VMWARE.HV.UUID},bps]'
          history: 7d
          units: bps
          username: '{$VMWARE.USERNAME}'
          password: '{$VMWARE.PASSWORD}'
          description: 'VMware HV network input statistics (bytes per second).'
          tags:
            - tag: component
              value: network
        - uuid: b013afcba08b47f4a5b590a59f464a58
          name: 'VMware: Bits sent'
          type: SIMPLE
          key: 'vmware.hv.network.out[{$VMWARE.URL},{$VMWARE.HV.UUID},bps]'
          history: 7d
          units: bps
          username: '{$VMWARE.USERNAME}'
          password: '{$VMWARE.PASSWORD}'
          description: 'VMware HV network output statistics (bytes per second).'
          tags:
            - tag: component
              value: network
        - uuid: e4116d7c7e234c5ebd5784f42ade1f2e
          name: 'VMware: Power usage maximum allowed'
          type: SIMPLE
          key: 'vmware.hv.power[{$VMWARE.URL},{$VMWARE.HV.UUID},max]'
          history: 7d
          units: '!W'
          username: '{$VMWARE.USERNAME}'
          password: '{$VMWARE.PASSWORD}'
          description: 'Maximum allowed power usage.'
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 6h
          tags:
            - tag: component
              value: power
        - uuid: 179a981cf30f4f77869e3b50dc2bc333
          name: 'VMware: Power usage'
          type: SIMPLE
          key: 'vmware.hv.power[{$VMWARE.URL},{$VMWARE.HV.UUID}]'
          history: 7d
          units: '!W'
          username: '{$VMWARE.USERNAME}'
          password: '{$VMWARE.PASSWORD}'
          description: 'Current power usage.'
          tags:
            - tag: component
              value: power
        - uuid: 3c9d6ffb53624758ad888bf70f69218c
          name: 'VMware: Get sensors'
          type: SIMPLE
          key: 'vmware.hv.sensors.get[{$VMWARE.URL},{$VMWARE.HV.UUID}]'
          history: '0'
          trends: '0'
          value_type: TEXT
          username: '{$VMWARE.USERNAME}'
          password: '{$VMWARE.PASSWORD}'
          description: 'Master item for sensors data.'
          tags:
            - tag: component
              value: raw
        - uuid: 0cec294521314c5482233b5b96e90c8d
          name: 'VMware: Overall status'
          type: SIMPLE
          key: 'vmware.hv.status[{$VMWARE.URL},{$VMWARE.HV.UUID}]'
          history: 7d
          username: '{$VMWARE.USERNAME}'
          password: '{$VMWARE.PASSWORD}'
          description: 'The overall alarm status of the host: gray - unknown, green - ok, red - it has a problem, yellow - it might have a problem.'
          valuemap:
            name: 'VMware status'
          tags:
            - tag: component
              value: health
          triggers:
            - uuid: 378511e0f1794874a68aef1b43561ee5
              expression: 'last(/VMware HV/vmware.hv.status[{$VMWARE.URL},{$VMWARE.HV.UUID}])=3'
              name: 'VMware: The {$VMWARE.HV.UUID} health is Red'
              priority: HIGH
              description: 'One or more components in the appliance might be in an unusable status and the appliance might become unresponsive soon. Security patches might be available.'
              tags:
                - tag: scope
                  value: availability
                - tag: scope
                  value: performance
            - uuid: ef6ca4d7033c4c8cb963eb7d493b3c7b
              expression: 'last(/VMware HV/vmware.hv.status[{$VMWARE.URL},{$VMWARE.HV.UUID}])=2'
              name: 'VMware: The {$VMWARE.HV.UUID} health is Yellow'
              priority: AVERAGE
              description: 'One or more components in the appliance might become overloaded soon.'
              dependencies:
                - name: 'VMware: The {$VMWARE.HV.UUID} health is Red'
                  expression: 'last(/VMware HV/vmware.hv.status[{$VMWARE.URL},{$VMWARE.HV.UUID}])=3'
              tags:
                - tag: scope
                  value: availability
                - tag: scope
                  value: performance
        - uuid: ecad96137494476293b57a0440de3f65
          name: 'VMware: Uptime'
          type: SIMPLE
          key: 'vmware.hv.uptime[{$VMWARE.URL},{$VMWARE.HV.UUID}]'
          history: 7d
          units: uptime
          username: '{$VMWARE.USERNAME}'
          password: '{$VMWARE.PASSWORD}'
          description: 'System uptime.'
          tags:
            - tag: component
              value: system
          triggers:
            - uuid: 01d316b0a8cf4998b344f0c4ef1daa32
              expression: 'last(/VMware HV/vmware.hv.uptime[{$VMWARE.URL},{$VMWARE.HV.UUID}])<10m'
              name: 'VMware: Hypervisor has been restarted'
              event_name: 'VMware: Hypervisor has been restarted (uptime < 10m)'
              priority: WARNING
              description: 'Uptime is less than 10 minutes.'
              manual_close: 'YES'
              tags:
                - tag: scope
                  value: notice
        - uuid: 222ad20887cf479b8e81a4c338078d17
          name: 'VMware: Version'
          type: SIMPLE
          key: 'vmware.hv.version[{$VMWARE.URL},{$VMWARE.HV.UUID}]'
          delay: 1h
          history: 7d
          trends: '0'
          value_type: CHAR
          username: '{$VMWARE.USERNAME}'
          password: '{$VMWARE.PASSWORD}'
          description: 'Dot-separated version string.'
          tags:
            - tag: component
              value: system
        - uuid: 2045df572e864834bd4bd97046353f4e
          name: 'VMware: Number of guest VMs'
          type: SIMPLE
          key: 'vmware.hv.vm.num[{$VMWARE.URL},{$VMWARE.HV.UUID}]'
          delay: 1h
          history: 7d
          username: '{$VMWARE.USERNAME}'
          password: '{$VMWARE.PASSWORD}'
          description: 'Number of guest virtual machines.'
          tags:
            - tag: component
              value: system
      discovery_rules:
        - uuid: fb7774df87994355baff7402d9fabcc2
          name: 'Datastore discovery'
          type: SIMPLE
          key: 'vmware.hv.datastore.discovery[{$VMWARE.URL},{$VMWARE.HV.UUID}]'
          delay: 1h
          username: '{$VMWARE.USERNAME}'
          password: '{$VMWARE.PASSWORD}'
          item_prototypes:
            - uuid: 65e6c165c3674953b2845d4101a9a6bf
              name: 'VMware: Multipath count for datastore {#DATASTORE}'
              type: SIMPLE
              key: 'vmware.hv.datastore.multipath[{$VMWARE.URL},{$VMWARE.HV.UUID},{#DATASTORE}]'
              history: 7d
              username: '{$VMWARE.USERNAME}'
              password: '{$VMWARE.PASSWORD}'
              description: 'Number of available datastore paths.'
              tags:
                - tag: component
                  value: datastore
                - tag: datastore
                  value: '{#DATASTORE}'
              trigger_prototypes:
                - uuid: 8f1de4827ba446ef902ca5fa44109c6d
                  expression: 'last(/VMware HV/vmware.hv.datastore.multipath[{$VMWARE.URL},{$VMWARE.HV.UUID},{#DATASTORE}],#1)<>last(/VMware HV/vmware.hv.datastore.multipath[{$VMWARE.URL},{$VMWARE.HV.UUID},{#DATASTORE}],#2) and last(/VMware HV/vmware.hv.datastore.multipath[{$VMWARE.URL},{$VMWARE.HV.UUID},{#DATASTORE}])<{#MULTIPATH.COUNT}'
                  name: 'VMware: The multipath count has been changed'
                  opdata: 'Current: {ITEM.LASTVALUE}, Registered: {#MULTIPATH.COUNT}'
                  priority: AVERAGE
                  description: 'The number of available datastore paths less than registered ({#MULTIPATH.COUNT}).'
                  manual_close: 'YES'
                  tags:
                    - tag: scope
                      value: notice
            - uuid: 259d1ff4bde143248f7ee2f7f880cb62
              name: 'VMware {#DATASTORE}: Disk read rate'
              type: SIMPLE
              key: 'vmware.hv.datastore.read[{$VMWARE.URL},{$VMWARE.HV.UUID},{#DATASTORE},latency]'
              history: 7d
              username: '{$VMWARE.USERNAME}'
              password: '{$VMWARE.PASSWORD}'
              description: 'Average amount of time for a read operation from the datastore (milliseconds).'
              tags:
                - tag: component
                  value: datastore
                - tag: datastore
                  value: '{#DATASTORE}'
            - uuid: f36245398cc4460a9cb4ec741612693b
              name: 'VMware {#DATASTORE}: Free space'
              type: SIMPLE
              key: 'vmware.hv.datastore.size[{$VMWARE.URL},{$VMWARE.HV.UUID},{#DATASTORE},free]'
              delay: 5m
              history: 7d
              units: B
              username: '{$VMWARE.USERNAME}'
              password: '{$VMWARE.PASSWORD}'
              description: 'VMware datastore space in percentage from total.'
              tags:
                - tag: component
                  value: datastore
                - tag: datastore
                  value: '{#DATASTORE}'
            - uuid: cc83e8f5ec08483db75482706bf01aba
              name: 'VMware {#DATASTORE}: Total space'
              type: SIMPLE
              key: 'vmware.hv.datastore.size[{$VMWARE.URL},{$VMWARE.HV.UUID},{#DATASTORE}]'
              delay: 5m
              history: 7d
              units: B
              username: '{$VMWARE.USERNAME}'
              password: '{$VMWARE.PASSWORD}'
              description: 'VMware datastore space in bytes.'
              tags:
                - tag: component
                  value: datastore
                - tag: datastore
                  value: '{#DATASTORE}'
            - uuid: 9dfa3a88160e438c8cead4bc4fdb4ddc
              name: 'VMware {#DATASTORE}: Used space'
              type: CALCULATED
              key: vmware.hv.datastore.used[{$VMWARE.URL},{$VMWARE.HV.UUID},{#DATASTORE},used]
              history: 7d
              units: B
              params: 'last(//vmware.hv.datastore.size[{$VMWARE.URL},{$VMWARE.HV.UUID},{#DATASTORE}])-last(//vmware.hv.datastore.size[{$VMWARE.URL},{$VMWARE.HV.UUID},{#DATASTORE},free])'
              description: 'Disk Used space'
              tags:
                - tag: component
                  value: datastore
                - tag: datastore
                  value: '{#DATASTORE}'
            - uuid: 82bdeb74777e43a493fe64eff65c58d9
              name: 'VMware {#DATASTORE}: Disk utilization'
              type: CALCULATED
              key: vmware.hv.datastore.utilization[{$VMWARE.URL},{$VMWARE.HV.UUID},{#DATASTORE}]
              history: 7d
              value_type: FLOAT
              units: '%'
              params: 'last(//vmware.hv.datastore.used[{$VMWARE.URL},{$VMWARE.HV.UUID},{#DATASTORE},used])/last(//vmware.hv.datastore.size[{$VMWARE.URL},{$VMWARE.HV.UUID},{#DATASTORE}]) * 100'
              description: 'Disk utilization in %.' 
              tags:
                - tag: component
                  value: datastore
                - tag: datastore
                  value: '{#DATASTORE}'
            - uuid: 9db980d8f5f44af5ad11a5949d80031d
              name: 'VMware {#DATASTORE}: Disk write rate'
              type: SIMPLE
              key: 'vmware.hv.datastore.write[{$VMWARE.URL},{$VMWARE.HV.UUID},{#DATASTORE},latency]'
              history: 7d
              username: '{$VMWARE.USERNAME}'
              password: '{$VMWARE.PASSWORD}'
              description: 'Average amount of time for a write operation to the datastore (milliseconds).'
              tags:
                - tag: component
                  value: datastore
                - tag: datastore
                  value: '{#DATASTORE}'
        - uuid: deb31adf69634837839e2d8f87167f28
          name: 'Healthcheck discovery'
          type: DEPENDENT
          key: vmware.hv.healthcheck.discovery
          delay: '0'
          description: 'VMware Rollup Health State sensor discovery'
          item_prototypes:
            - uuid: fabb7524dd454daa942266e5565ce40e
              name: 'VMware: Health state rollup'
              type: DEPENDENT
              key: 'vmware.hv.sensor.health.state[{#SINGLETON}]'
              delay: '0'
              history: 7d
              trends: '0'
              value_type: CHAR
              description: 'The host health state rollup sensor value: gray - unknown, green - ok, red - it has a problem, yellow - it might have a problem.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$..HostNumericSensorInfo[?(@.name=="VMware Rollup Health State")].healthState.label.first()'
              master_item:
                key: 'vmware.hv.sensors.get[{$VMWARE.URL},{$VMWARE.HV.UUID}]'
              tags:
                - tag: component
                  value: health
              trigger_prototypes:
                - uuid: 9f2a65161946436986aacf6c9a637673
                  expression: 'last(/VMware HV/vmware.hv.sensor.health.state[{#SINGLETON}])="Red"'
                  name: 'VMware: The {$VMWARE.HV.UUID} health is Red'
                  priority: HIGH
                  description: 'One or more components in the appliance might be in an unusable status and the appliance might become unresponsive soon. Security patches might be available.'
                  dependencies:
                    - name: 'VMware: The {$VMWARE.HV.UUID} health is Red'
                      expression: 'last(/VMware HV/vmware.hv.status[{$VMWARE.URL},{$VMWARE.HV.UUID}])=3'
                  tags:
                    - tag: scope
                      value: availability
                    - tag: scope
                      value: performance
                - uuid: dc4f84eb8d2143bb80999fbc58f38928
                  expression: 'last(/VMware HV/vmware.hv.sensor.health.state[{#SINGLETON}])="Yellow"'
                  name: 'VMware: The {$VMWARE.HV.UUID} health is Yellow'
                  priority: AVERAGE
                  description: 'One or more components in the appliance might become overloaded soon.'
                  dependencies:
                    - name: 'VMware: The {$VMWARE.HV.UUID} health is Red'
                      expression: 'last(/VMware HV/vmware.hv.sensor.health.state[{#SINGLETON}])="Red"'
                    - name: 'VMware: The {$VMWARE.HV.UUID} health is Red'
                      expression: 'last(/VMware HV/vmware.hv.status[{$VMWARE.URL},{$VMWARE.HV.UUID}])=3'
                    - name: 'VMware: The {$VMWARE.HV.UUID} health is Yellow'
                      expression: 'last(/VMware HV/vmware.hv.status[{$VMWARE.URL},{$VMWARE.HV.UUID}])=2'
                  tags:
                    - tag: scope
                      value: availability
                    - tag: scope
                      value: performance
          master_item:
            key: 'vmware.hv.sensors.get[{$VMWARE.URL},{$VMWARE.HV.UUID}]'
          preprocessing:
            - type: JSONPATH
              parameters:
                - '$..HostNumericSensorInfo[?(@.name=="VMware Rollup Health State")]'
              error_handler: CUSTOM_VALUE
              error_handler_params: '[]'
            - type: JAVASCRIPT
              parameters:
                - 'return JSON.stringify(value != "[]" ? [{''{#SINGLETON}'': ''''}] : []);'
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 6h
      tags:
        - tag: class
          value: software
        - tag: target
          value: vmware
        - tag: target
          value: vmware-hypervisor
      macros:
        - macro: '{$VMWARE.PASSWORD}'
          description: 'VMware service {$USERNAME} user password'
        - macro: '{$VMWARE.URL}'
          description: 'VMware service (vCenter or ESX hypervisor) SDK URL (https://servername/sdk)'
        - macro: '{$VMWARE.USERNAME}'
          description: 'VMware service user name'
        - macro: '{$ICMP_LOSS_WARN}'
          value: '20'
        - macro: '{$ICMP_RESPONSE_TIME_WARN}'
          value: '0.15'
      valuemaps:
        - uuid: 25d04e2838af4fcca9ddd21df6781497
          name: 'Service state'
          mappings:
            - value: '0'
              newvalue: Down
            - value: '1'
              newvalue: Up
        - uuid: 2b324fd8d7624874a3a81449b62c2cd6
          name: 'VMware status'
          mappings:
            - value: '0'
              newvalue: gray
            - value: '1'
              newvalue: green
            - value: '2'
              newvalue: yellow
            - value: '3'
              newvalue: red